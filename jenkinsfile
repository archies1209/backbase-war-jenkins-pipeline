pipeline{
    agent any
    stages{
        stage('Clone Repository'){
		    steps{
				 git url: 'https://github.com/archies1209/backbase-war-jenkins-pipeline'
		    }
        }
        stage('Build Image'){
		    steps{
				sh("docker build -t archies1209/tomcat . ")  
			}
		}
        stage('Push image'){
            steps{
                withCredentials([usernamePassword(credentialsId: 'docker-credentials', passwordVariable: 'DOCKER_PASSWORD', usernameVariable: 'DOCKER_USERNAME')]) {
                    sh("docker login -u=${DOCKER_USERNAME} -p=${DOCKER_PASSWORD}")
                    sh("docker push archies1209/tomcat:latest")
                }
                //To remove the image locally
                //sh("docker rmi archies1209/tomcat:latest")
            }
        }
		stage('run image') {
		     steps{
			        sh("docker run -it -p 8080:8080 archies1209/tomcat:latest")
			}
        }
	}
}