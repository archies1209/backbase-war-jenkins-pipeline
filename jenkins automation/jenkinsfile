pipeline {
        stage('Build Image') {
            agent any
            steps {
                sh("rm -fr ./*")
                git url: 'https://github.com/abhijithvg/jenkins-pipeline-demo'
                sh('mv target tomcat/')
				sh('docker build -t archies1209/tomcat . ')
				sh('docker run -it -p 8080:8080 archies1209/tomcat:latest)
            }
        }
        stage('Push image') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'docker-credentials', passwordVariable: 'DOCKER_PASSWORD', usernameVariable: 'DOCKER_USERNAME')]) {
                    sh("docker login -u=${DOCKER_USERNAME} -p=${DOCKER_PASSWORD}")
                    sh("docker push archies1209/tomcat:latest")
                }
                //To remove the image locally
                //sh('docker rmi archies1209/tomcat:latest')
            }
        }
        }
    }
